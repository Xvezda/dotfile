#!/bin/bash
# @Copyright (c) 2018 Xvezda <https://xvezda.com>
# @Description: backup script for dotfiles

# Get script's path
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && pwd )"
cd $DIR

# Create path
BACKUP_DIRS=("git" "vim" "tmux" "brew" "zsh" "tidy")
for p in "${BACKUP_DIRS[@]}"
do
    mkdir -p src/$p
done

# Backup git dotfiles
which git && test -f $HOME/.gitignore && cp $HOME/.gitignore src/git/gitignore

# Backup vim dotfiles
cp -R $HOME/.vim/private src/vim/
cp -R $HOME/.vim/syntax src/vim/
cp -R $HOME/.vim/UltiSnips src/vim/
cp $HOME/.vimrc src/vim/vimrc
cp $HOME/.vimrc.local src/vim/vimrc.local
cp $HOME/.vimrc.local.bundles src/vim/vimrc.local.bundles

# Backup tmux dotfiles
which tmux    && cp $HOME/.tmux.conf src/tmux/tmux.conf
test $? -eq 0 && cp $(ls $HOME/.tmux/*.conf) src/tmux/

# Backup brew dotfiles
which brew && brew bundle dump && mv $PWD/Brewfile src/brew

# Backup zsh dotfiles
which zsh     && cp $HOME/.zshrc src/zsh/zshrc
test $? -eq 0 && cp $HOME/.zprofile src/zsh/zprofile

# Backup tidy configuration
which tidy && cp $HOME/.tidyrc src/tidy/tidyrc

# Backup pip requirements
# Prefer python3 if exists
which python3 && PYTHON_BIN=python3 || PYTHON_BIN=python
$PYTHON_BIN -m pip --version && \
    $PYTHON_BIN -m pip freeze > src/pip/requirements-${XVZD_OSTYPE}.txt

echo "[+] Success backup!"


# ft:vim=sh
